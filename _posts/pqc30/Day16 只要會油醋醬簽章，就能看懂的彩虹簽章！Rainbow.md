
今天我們來介紹彩虹簽章！

# 回顧昨天油醋醬簽章

首先，隨機生成中間映射，中間映射由油醋多項式構成：
$$
f^{(i)}
=
\sum_{j=1}^{v} \sum_{k=j}^{v}\alpha_{jk}^{(i)} x_{j}x_{k} 
+
\sum_{j=1}^{v} \sum_{k=v+1}^{n}\beta_{jk}^{(i)} x_{j}x_{k} 
+
\sum_{j=1}^{n} \gamma_{j}^{(i)} x_{j} +\delta^{(i)}
$$
在簽章的時候，我們會隨機給醋變量 x1, ..., x_v 一組隨機值，於是未知數只剩下紅色的油變量
$$
w_{i}
=
\sum_{j=1}^{v} \sum_{k=j}^{v}\alpha_{jk}^{(i)} x_{j}x_{k} 
+
\sum_{j=1}^{v} \sum_{k=v+1}^{n}\beta_{jk}^{(i)} x_{j}{\color{red}x_{k}}
+
\sum_{j=1}^{v} \gamma_{j}^{(i)} x_{j}
+
\sum_{k=v+1}^{n} \gamma_{k}^{(i)} {\color{red}x_{k}}+\delta^{(i)}
$$
這是一個對油變量的線性方程式，因此我們有很高的機會求解，若無解的話，我們重新生成醋變量的值，若無限多組解，那我們可以隨機挑一個。

# 層次化的中間映射

好，簡單來說，彩虹簽章就是很多層的油醋簽章組合重疊而成。

令 
$$
0 < v_{1}<v_{2}<\dots<v_{u}<v_{u+1}=n
$$
$$
o_{i} = v_{i+1} - v_{i}
$$
一共有 n 個變量
$$
x_{1},x_{2},\dots,x_{v_{1}},x_{v_{1}+1},\dots, x_{v_{2}},x_{v_{2}+1},\dots,x_{v_{u+1}-1},x_{n}
$$
請想像一下：假設一開始我們把前 v1 個變量先當作醋變量，並隨機生成他的值。把第 v1 + 1 到 v2 個變量先當作油變量，那我們可以透過 o1 個形如以下的 v1-o1 油醋多項式中求到這 o1 個油變量的值
$$
f^{(i)}
=
\sum_{j=1}^{v_{1}} \sum_{k=j}^{v_{1}}\alpha_{jk}^{(i)} x_{j}x_{k} 
+
\sum_{j=1}^{v_{1}} \sum_{k=v_{1}+1}^{v_{1}+o_{1}}\beta_{jk}^{(i)} x_{j}x_{k} 
+
\sum_{j=1}^{v_{1}+o_{1}} \gamma_{j}^{(i)} x_{j} +\delta^{(i)}
$$
到此為止我們一共知道了 v2 = v1 + o1 個變量的值。接著把接下來的 v2+1 到 v3 個變量當作油變量，那我們可以透過 o2 個形如以下的 v2-o2 油醋多項式中求到這 o2 個油變量的值
$$
f^{(i)}
=
\sum_{j=1}^{v_{2}} \sum_{k=j}^{v_{2}}\alpha_{jk}^{(i)} x_{j}x_{k} 
+
\sum_{j=1}^{v_{2}} \sum_{k=v_{2}+1}^{v_{2}+o_{2}}\beta_{jk}^{(i)} x_{j}x_{k} 
+
\sum_{j=1}^{v_{2}+o_{2}} \gamma_{j}^{(i)} x_{j} +\delta^{(i)}
$$
到此為止我們一共知道了 v3 = v2 + o2 個變量的值。

以此類推，最終就可以求到所有的 x 變量。在這過程中，各層分別需要用到 o1 + o2 + ... + o_u = n - v1 個油醋多項式。




# 彩虹簽章

## 雙極構造法

生成兩個隨機的可逆仿射變換 S 與 T 
中間映射為 F ，分別由 o1 個 v1-o1 油醋多項式、o2 個 v2-o2 油醋多項式、......、o_u 個 v_u-o_u 油醋多項式。一共有 n - v1 個油醋多項式。

私鑰為 S, F, T
公鑰為 P(x) = S(F(T(x)))

S 與 T，分別是作用在 n-v1 維與 n 維空間上。
## 簽章過程
好！我們來看簽章過程！

假設我們要簽章的文件經過 hash 函數後是
$$
w  = (w_{1},w_{2},\dots,w_{n-v_{1}})
$$
這是一個 n - v1 維度的向量。

首先我們會先計算
$$
x = \mathcal{S}^{-1}(w)
$$
其中 x 是 n - v1 維度的向量

接著計算
$$
y = \mathcal{F}^{-1}(x)
$$
這個部分是透過我們第二節「層次化的中間映射」中介紹的方法計算得到。其中 y 是 n 維度的向量。

最後計算
$$
z = \mathcal{T}^{-1}(y)
$$
其中 z 是 n 維度的向量。

發送簽名
$$
\sigma = (d, w, z)
$$

## 驗章過程

計算 P(z) 並檢查：
$$
P(z) = w 
$$
若以上等式成立，則簽名為有效簽名。Done


# Takeaway

- 何謂層次化的中間映射？

層次化的中間映射是將變量分層，逐層求解油變量的方法，每一層利用已知的醋變量，解決對應的油醋多項式方程組。


# 後記

道歉啟事：今天收到兵單，心情極度鬱卒，因此沒有把程式寫好。（你可以在這裡看到月亮巨蟹人是有多容易被心情影響工作......）



ref  
DING, Jintai; GOWER, Jason E.; SCHMIDT, Dieter S. _Multivariate public key cryptosystems_. Springer Science & Business Media, 2006.