
æˆ‘å€‘æ˜¨å¤©ä»‹ç´¹äº† LD-OTS ç°½ç« ï¼Œé€™å€‹ç³»çµ±æ˜¯å°è¨Šæ¯çš„æ¯å€‹ä½å…ƒé€ä¸€é€²è¡Œç°½ç« ï¼Œä¹Ÿå› æ­¤æœ€å¾Œçš„ç°½ç« å¤§å°éå¸¸å¤§ã€‚ä»Šå¤©ä¾†ä¿®æ”¹ä¸€ä¸‹åšæ³•ï¼Œæˆ‘å€‘å°è¨Šæ¯å­—ä¸²çš„å››å€‹å››å€‹ï¼Œæˆ–å…«å€‹å…«å€‹ä¸€å¡Šä¸€å¡Šé€²è¡Œç°½ç« ï¼Œé€™ä¹Ÿè¨±å¯ä»¥å¤§å¤§é™ä½æœ€å¾Œçš„ç°½ç« å¤§å°ã€‚

# æ¦‚å¿µä»‹ç´¹
å‡è¨­æˆ‘å€‘è¦ç°½ç« çš„è¨Šæ¯ç‚º
$$
d = 0101011010\dots\dots 
$$
é‚£å…¶å¯¦å¯ä»¥ä¸ç”¨é€å€‹ä½å…ƒé€²è¡Œç°½ç« ï¼Œè€Œæ˜¯ä¸€æ®µä¸€æ®µé€²è¡Œç°½ç« ï¼Œæˆ‘å€‘é€™è£¡ä¸€æ¬¡å°å››å€‹ä½å…ƒé€²è¡Œç°½ç« ã€‚
$$
d = \underbrace{ 0101 }_{ \text{4 bits}}\ \underbrace{ 0110 }_{   \text{4 bits}}\ 10\dots\dots \underbrace{ 1000 }_{  \text{4 bits} }
$$
å…¶ä¸­æœ€å°¾ç«¯çš„éƒ¨åˆ†å¦‚æœæœ‰ç¼ºé …å°±è£œé›¶é€²å»ã€‚

æ¯å€‹å€å¡Šéƒ½å¯ä»¥è¨ˆç®—å…¶å€å¡Šå€¼ï¼Œå°±æ˜¯ä»–é€™å€‹å€å¡Šæ‰€è¡¨é”çš„äºŒé€²ä½æ•¸å€¼
$$
d = \underbrace{ 0101 }_{ M_{0}=5 }\ \underbrace{ 0110 }_{ M_{1}=6 }\ 10\dots\dots \underbrace{ 1000 }_{ M_{end}=8 }
$$

ç¾åœ¨æˆ‘å€‘å°‡å°æ¯å€‹å€å¡Šé€²è¡Œç°½ç« ï¼Œéç¨‹ä¸­æœƒç”¨åˆ°
ç§é‘°ï¼šé¦–å…ˆæœƒå°é€™å€‹å€å¡Šç”Ÿæˆä¸€æŠŠç§é‘° sk ï¼ŒåŸºæœ¬ä¸Šå¯ç•¶ä½œä¸€å€‹ n ä½å…ƒçš„éš¨æ©ŸäºŒé€²ä½å­—ä¸²ã€‚

å…¬é‘°ï¼š
ä¸€å€‹ hash å‡½æ•¸ H
ç”Ÿæˆ 15 å€‹ n ä½å…ƒçš„éš¨æ©ŸäºŒç¶­å­—ä¸² r = r_1, r_2, ..., r_15ã€‚
é©—è­‰ç”¨çš„é‘°åŒ™ pk æœƒç”¨ä»¥ä¸‹çš„æ–¹å¼ä¾†è¨ˆç®—ï¼š
$$
\left\{\begin{aligned}
c^{0}(\mathrm{sk}, r) &= \mathrm{sk}\\
c^{k}(\mathrm{sk}, r) &= \mathcal{H}(c^{k-1}(\mathrm{sk},r) \oplus r_{k})
\end{aligned}\right.
$$
$$
c^{15}(\mathrm{sk},r) = \mathrm{pk}
$$
ï¼ˆä½ å¾ˆå¿«æœƒçœ‹åˆ°ç‚ºä»€éº¼é€™è£¡æ˜¯åäº”ï¼‰

ä»¥ç¬¬ä¸€å€‹å€å¡Š 0101 ç‚ºä¾‹ï¼Œå…¶å€å¡Šå€¼ç‚º M0ã€‚æ­¤å€å¡Šçš„ç°½ç« æœƒæ ¹æ“šä»¥ä¸‹æ–¹ç¨‹æ±ºå®š
$$
\sigma_{0} = \left\{\begin{aligned}
c^{0}(\mathrm{sk}, r) &= \mathrm{sk}\\
c^{M_{0}}(\mathrm{sk}, r) &= \mathcal{H}(c^{M_{0}-1}(\mathrm{sk},r) \oplus r_{M_{0}})
\end{aligned}\right.
$$
åœ¨é€™å€‹ä¾‹å­è£¡ï¼Œ M0 = 5ï¼Œæ‰€ä»¥
$$
\sigma_{5} = c^{5}(\mathrm{sk},r) = \mathcal{H}(c^{4}(\mathrm{sk},r)\oplus r_{5}) = \mathcal{H}(\mathcal{H}(c^{3}(\mathrm{sk},r)\oplus r_{4})\oplus r_{5}) = \dots
$$

ä»¥æ­¤é¡æ¨ï¼Œå°±å¯ä»¥å°æ¯ä¸€å€‹å€å¡Šé€²è¡Œç°½ç« ï¼ˆè«‹æ³¨æ„æ¯å€‹å€å¡Šéƒ½å…±ç”¨ä¸€æ¨£çš„ r å­—ä¸²ã€å¦å¤–ä¹Ÿè«‹æ³¨æ„ M0 çš„æœ€å¤§å€¼ç‚º 15 å› æ­¤ r å­—ä¸²åªéœ€æº–å‚™åäº”å€‹ï¼‰


è‡³æ–¼é©—è­‰çš„éƒ¨åˆ†ï¼Œé©—è­‰è€…æ‹¿åˆ°
$$
\sigma = c^{5}(\mathrm{sk},r)
$$
ä»¥åŠå…¬é‘°è£¡é¢çš„ r ã€æ–‡ä»¶çš„å€å¡Šå€¼ M0ï¼Œå°±å¯ä»¥ç¹¼çºŒåšå‡º
$$
c^{6}(\mathrm{sk},r) = \mathcal{H}(c^{5}(\mathrm{sk},r)\oplus r_{6})
$$
$$
c^{7}(\mathrm{sk},r), c^{8}(\mathrm{sk},r),   c^{9}(\mathrm{sk},r), \dots  c^{15}(\mathrm{sk},r). 
$$
ï¼ˆå› ç‚ºçŸ¥é“æ–‡ä»¶çš„å€å¡Šå€¼ï¼Œæ‰€ä»¥åŒæ¨£è¨ˆç®— c çš„è¦å‰‡å†åš 15 - M0 æ¬¡å³å¯å¾—åˆ° c^15(x,r) ã€‚ï¼‰
è€Œä¸Šé¢æœ€å¾Œä¸€å€‹æ•¸å€¼å°±æ°å¥½æ˜¯æˆ‘å€‘ä¹‹å‰è¨­å®šçš„é©—è­‰ç”¨é‘°åŒ™ pk
$$
c^{15}(\mathrm{sk},r) = \mathrm{pk}.
$$
è‹¥é€™å€‹ç­‰å¼æˆç«‹ï¼Œå‰‡é€™å€‹å€å¡Šçš„ç°½ç« ç‚ºæœ‰æ•ˆã€‚


å°‡åŒæ¨£çš„æµç¨‹é‡è¤‡æ–¼æ–‡ä»¶çš„æ¯ä¸€å€å¡Šï¼Œæœ€å¾Œå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„ç°½ç« ï¼Œåœ¨å°æ¯ä¸€å€å¡Šé€²è¡ŒåŒæ¨£çš„é©—ç« æµç¨‹ï¼Œå³å¯ç¢ºèªç°½ç« æ˜¯å¦æœ‰æ•ˆã€‚

# ä½†æ˜¯æœ‰ä¸€å€‹å°å•é¡Œ
é€šå¸¸ä¸€å€‹æœ‰æ•¸å­—çš„æ–‡ä»¶å¾ˆå¯èƒ½æ˜¯é‡è¦çš„æ•æ„Ÿè³‡è¨Šï¼Œé€™é¡æ–‡ä»¶ä¹Ÿé€šå¸¸è¦ä½¿ç”¨ç°½ç« ç³»çµ±ä¾†ä¿è­·ã€‚

å‡è¨­æœ‰ä¸€å€‹è¦ç°½ç« çš„æ–‡ä»¶ï¼Œè£¡é¢åŒ…å«æ•¸å­— 1000ï¼Œè€Œä¸”å¾ˆä¸å¹¸çš„ï¼Œé€™å€‹ 1000 å°±å‰›å¥½å®Œç¾åœ°è½åœ¨ä¸€å€‹å€å¡Šè£¡é¢ï¼š
$$
d = \dots\dots \underbrace{ 1000 }_{ M_{i} = 8 } \dots\dots
$$
é‚£éº¼æ ¹æ“šç°½ç« æµç¨‹ï¼Œé€™å€‹å€å¡Šçš„ç°½ç« ç‚º
$$
\sigma_{i} =c^{8}(\mathrm{sk},r).
$$
æ­£å¸¸çš„ç°½é©—ç« æµç¨‹éƒ½èƒ½å¦‚é æœŸé€²è¡Œã€‚

ä½†æ˜¯å¦‚æœä»Šå¤©æœ‰ä¸è‚–äººå£«ï¼ˆæ”»æ“Šè€…ï¼‰æƒ³è¦æŠŠæ–‡ä»¶è£¡é¢çš„ 1000 æ”¹æˆ 1001ï¼Œé‚£éº¼ä»–å®Œå…¨å¯ä»¥è¨ˆç®—
$$
\hat{\sigma}_{i} =  c^{9}(\mathrm{sk},r)  = \mathcal{H}(c^{8}(\mathrm{sk},r)\oplus r_{9})
$$
å› ç‚º r_9 æ˜¯å…¬é‘°çš„ä¸€éƒ¨åˆ†ï¼Œ H ä¹Ÿæ˜¯å…¬é‘°çš„ä¸€éƒ¨åˆ†ã€‚æ”»æ“Šè€…è¨ˆç®—å®Œç•¢å¾Œï¼Œå¯ä»¥æŠŠåŸæœ¬çš„ç°½ç« 
$$
d = \dots\dots 1000\dots\ldots \leftrightarrow \sigma = \dots\dots \sigma_{i}\dots\ldots 
$$
æ›¿æ›ç‚º
$$
\hat{d} = \dots\dots 1001\dots\ldots \leftrightarrow \hat{\sigma} = \dots\dots \hat{\sigma}_{i}\dots\ldots 
$$
æ–¼æ˜¯ï¼Œå½é€ çš„ç°½ç« å°±æµå‡ºåœ¨ç¶²è·¯ä¸Šäº†ï¼Œè€Œä¸”æ ¹æ“šç°½ç« çš„ç‰¹æ€§ï¼ŒåŸæœ¬çš„ç°½ç« è€…ä¸èƒ½å¦èªæ”»æ“Šè€…å½é€ çš„æ–‡ä»¶ã€‚

## è§£æ±ºæ–¹æ³•
é€™å€‹æ”»æ“Šä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ç‚ºå¾ c^i è¨ˆç®— c^(i+1) æ˜¯ç°¡å–®çš„ï¼Œä½†æ˜¯åä¹‹ï¼Œå¾ c^(i+1) ç®—å› c^i æ˜¯æ¥µå…¶å›°é›£ï¼Œå› ç‚ºç•¶ä¸­æ¶‰åŠåˆ°è¦è¨ˆç®— hash å‡½æ•¸çš„åå‡½æ•¸ã€‚ï¼ˆæˆ‘å€‘ç”šè‡³å¯ä»¥èªªé€™å€‹è¨ˆç®—æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ç‚º hash çš„ä¸å¯é€†æ€§æ˜¯æ•´å€‹ hash-based cryptography çš„æœ€åŸºç¤çš„å‡è¨­ã€‚ï¼‰

å€Ÿç”¨ã€ŒéŒ¯èª¤æ›´æ­£ç¢¼ã€çš„æƒ³æ³•ï¼šå‡è¨­æˆ‘å€‘å¯ä»¥åœ¨æ–‡ä»¶ d çš„å¾Œé¢ï¼ŒåŠ ä¸Šä¸€äº›ã€Œå†—ä½™ã€ï¼ˆredundancyï¼‰ï¼Œå¥½æ»¿è¶³èªªã€Œç•¶å‰é¢æ–‡ä»¶è£¡çš„æŸå€‹å€å¡Šå€¼å¢åŠ çš„æ™‚å€™ï¼Œå¾Œé¢ã€å†—ä½™ã€çš„æŸå€å¡Šå…¶å€å¡Šå€¼æœƒæ¸›å°‘ã€ã€‚

å¦‚æ­¤ä¸€ä¾†ï¼ŒåŒæ¨£çš„æ”»æ“Šï¼Œé›–ç„¶ç¢ºå¯¦å¯ä»¥åœ¨å‰é¢æ–‡ä»¶è£¡æŸå€‹å€å¡Šå€¼å¢åŠ çš„æ™‚å€™ç°½å‡ºä¸€å€‹æ­£ç¢ºç°½ç« ï¼Œä½†æ˜¯å»æ²’è¾¦æ³•åœ¨å¾Œé¢å†—ä½™éƒ¨åˆ†ï¼Œå€å¡Šå€¼æ¸›å°‘çš„åœ°æ–¹ç°½å‡ºæ­£ç¢ºçš„ç°½ç« ã€‚é€™è£¡å†é‡è¤‡ä¸€æ¬¡ï¼šã€Œå¾ c^(i+1) ç®—å› c^i æ˜¯æ¥µå…¶å›°é›£ï¼Œå› ç‚ºç•¶ä¸­æ¶‰åŠåˆ°è¦è¨ˆç®— hash å‡½æ•¸çš„åå‡½æ•¸ã€


é‚£éº¼å…·é«”çš„è¨­è¨ˆè©²æ€éº¼åšå‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥è¨­è¨ˆä¸€å€‹è‹±æ–‡å« checksum çš„å†—ä½™åœ¨å¾Œé¢ï¼Œæˆ‘å°‡ä¸­æ–‡ç¿»è­¯ç‚ºã€Œæ•¸å€¼å’Œæª¢æŸ¥ç¢¼ã€ï¼ˆåŸºæœ¬ä¸Šå°±æ˜¯ç›´ç¿»ğŸ˜‚ï¼‰

æˆ‘å€‘ä»¤ã€Œæ•¸å€¼å’Œæª¢æŸ¥å€¼ã€ç‚º
$$
C = \left\lceil \frac{l_{1}}{4} \right  \rceil  \cdot 2^{4} - \sum_{i} M_{i}
$$
å…¶ä¸­ l_1 ç‚ºæ–‡ä»¶ d çš„äºŒé€²ä½é•·åº¦ã€‚ é€™å€‹ C æ°¸é æ˜¯æ­£æ•¸ï¼Œå› ç‚ºæ¯å€‹ M_i éƒ½ä¸è¶…é 15 ï¼Œè€Œä¸” M_i çš„å€‹æ•¸ä¸è¶…é l_1 é™¤ä»¥ 4 çš„å¤©èŠ±æ¿å‡½æ•¸ã€‚ä½ é¦¬ä¸Šæ³¨æ„åˆ°ç•¶æŸå€‹å€å¡Šå€¼ M_i å¢åŠ æ™‚ï¼Œé€™å€‹æ•¸å€¼å’Œæª¢æŸ¥å€¼ C æ˜¯è®Šå°çš„ã€‚

æ¥è‘—æˆ‘å€‘è¬› C å¯«æˆäºŒé€²ä½ï¼Œä¸¦å«æ¥åœ¨åŸæœ¬è¦ç°½ç« çš„ d å¾Œé¢ï¼š
$$
d || C
$$
ç„¶å¾Œæ ¹æ“šæˆ‘å€‘ä¸Šé¢ç¬¬ä¸€ç« çš„åšæ³•ï¼Œå°é€™å€‹ d èˆ‡ C çš„å¤§å­—ä¸²é€²è¡Œé€å€å¡Šçš„ç°½ç« ã€‚æ–¼æ˜¯ï¼Œæˆ‘å€‘å°±æˆåŠŸé˜²ç¦¦äº†æœ¬ç« ä¸€é–‹é ­æ‰€ä»‹ç´¹çš„æ”»æ“Šã€‚

## æœ€å¾Œçš„ä¸€é»åŠŸèª²
æ³¨æ„åˆ° C æœ€å¤§ç‚º
$$
C_{max}
=\left\lceil \frac{l_{1}}{4} \right  \rceil  \cdot 2^{4} 
$$
æ‰€ä»¥å°‡ä»–è¡¨ç‚ºäºŒé€²ä½å­—ä¸²æ™‚ï¼Œæœ€å¤§é•·åº¦ç‚º
$$
l_{2} = \lceil \log_{2}C_{max} \rceil 
$$
æ‰€ä»¥æˆ‘å€‘å¯ä»¥ç›´æ¥åœ¨åŸæœ¬çš„æ–‡ä»¶å¾Œé¢åŠ ä¸Š l_2 å€‹ä½å…ƒï¼Œç¼ºé …ç›´æ¥è£œé›¶ã€‚


# å®Œæ•´å”è­°

å¥½ï¼åˆ°ç›®å‰ç‚ºæ­¢æˆ‘å€‘éƒ½ä½¿ç”¨ 4 ç‚ºä¸€å€‹å€å¡Šçš„å¤§å°ï¼Œå¯¦éš›ä¸Šé€™å€‹æ•¸å­—æ˜¯å¯ä»¥æ›´æ”¹çš„ï¼Œä¸¦ä¸”æ˜¯å…¬é‘°çš„ä¸€éƒ¨åˆ†ã€‚

## é‘°åŒ™ç”Ÿæˆ
1. æ±ºå®šå€å¡Šå¤§å°ï¼Œä¸€å€‹å€å¡Šç”±
$$
\log_{2}w 
$$
å€‹ä½å…ƒçµ„æˆï¼Œå…¶ä¸­ w ç‚ºäºŒçš„æŸæ¬¡æ–¹ã€‚ï¼ˆä¸Šé¢çš„èˆ‰ä¾‹ä¸­ w = 16, log_2(w) = 4ï¼‰

2. æ•¸å€¼å’Œæª¢æŸ¥å€¼æœ€é«˜ç‚º
$$
C_{max} = \left\lceil  \frac{l_{1}}{\log_{2}(w)}  \right\rceil\cdot w
$$
å…¶ä¸­ l_1 ç‚ºæœ¬ä¾†è¦ç°½ç« çš„æ–‡ä»¶ d çš„äºŒé€²ä½å­—ä¸²é•·åº¦ã€‚æ‰€ä»¥æˆ‘å€‘å°‡æœƒåœ¨ d å¾Œé¢å¢åŠ  
$$
l_{2} = \log_{2}C_{max}
$$
ä½å…ƒçš„æ•¸å€¼å’Œæª¢æŸ¥ç¢¼ã€‚å…¨é•·ç‚º
$$
l = l_{1}+l_{2}
$$
3. æ¯å€‹å€æ®µç‚º log_2(w) ä½å…ƒï¼Œæ‰€ä»¥æˆ‘å€‘æœ€å¤šéœ€è¦
$$
\left\lceil  \frac{l}{\log_{2}(w)}  \right\rceil 
$$
å€‹ç§é‘° sk ï¼Œé€™å€‹ç§é‘°æœ¬è³ªä¸Šå°±æ˜¯ä¸€å€‹ n é•·åº¦çš„éš¨æ©ŸäºŒé€²ä½å­—ä¸²ã€‚
4. å…¬é‘°å¦å¤–é‚„åŒ…å« w-1 å€‹é•·åº¦ n çš„éš¨æ©ŸäºŒé€²ä½å­—ä¸² r = r_1, r_2, ...
5. é©—è­‰ç”¨çš„é‘°åŒ™ pk æœƒç”¨ä»¥ä¸‹çš„æ–¹å¼ä¾†è¨ˆç®—ï¼š
$$
\left\{\begin{aligned}
c^{0}(\mathrm{sk}, r) &= \mathrm{sk}\\
c^{k}(\mathrm{sk}, r) &= \mathcal{H}(c^{k-1}(\mathrm{sk},r) \oplus r_{k})
\end{aligned}\right.
$$
$$
c^{w-1}(\mathrm{sk},r) = \mathrm{pk}
$$


## ç°½ç« 

1. å°‡æ–‡ä»¶ d åˆ†ç‚ºé•·åº¦ç‚º log_2(w) çš„å€å¡Š
$$
d = d_{0},d_{1},\dots
$$
ä¸¦è¨ˆç®—æ¯å€‹å€å¡Šçš„å€å¡Šå€¼ M_i ã€‚
2. è¨ˆç®—æ•¸å€¼å’Œæª¢æŸ¥å€¼
$$
C = \left\lceil \frac{l_{1}}{\log_{2}(w)} \right  \rceil  \cdot w - \sum_{i} M_{i}
$$
ä¸¦ä»¥äºŒé€²ä½è¡¨ç¤ºæ³•å«æ¥åœ¨æ–‡ä»¶ d çš„å¾Œé¢ã€‚
3. å°æ–¼å¤§å­—ä¸²
$$
d || C
$$
é€å€æ®µé€²è¡Œç°½ç« ã€‚æ¯å€‹å€å¡Šæ ¹æ“šå…¶å€å¡Šå€¼ M_i ç”Ÿæˆç°½ç« 
$$
\sigma_{i} = c^{M_{i}}(x,r)
$$
4. ç™¼é€ç°½ç« 
$$
(d, C, \sigma)
$$

## é©—ç« 
ç›´æ¥é‡å°å¤§å­—ä¸²
$$
d||C
$$
é€å€æ®µé€²è¡Œé©—ç« å³å¯ã€‚



# é€²è¡Œå¯¦ä½œ
é¦–å…ˆå…ˆè¨­å®š hashlib ä»¥åŠè¦ä½¿ç”¨çš„ hash å‡½æ•¸
```
import hashlib
import random

# å®šç¾©å“ˆå¸Œå‡½æ•¸ (SHA-256)
def hash_func(data):
    # è¨ˆç®— SHA-256 å“ˆå¸Œå€¼
    sha256_hash = hashlib.sha256(data.encode()).digest()
    
    # å°‡å“ˆå¸Œçµæœè½‰æ›ç‚ºäºŒé€²åˆ¶æ ¼å¼ï¼Œä¸¦è¿”å› 256 ä½çš„äºŒé€²åˆ¶å­—ä¸²
    return ''.join(f'{byte:08b}' for byte in sha256_hash)

# å°‡è¨Šæ¯è½‰æ›ç‚ºäºŒé€²ä½å­—ä¸²
def message_to_binary(message):
    return ''.join(format(ord(c), '08b') for c in message)


```

è¨Šæ¯èˆ‡åƒæ•¸é¸æ“‡
```
# è¨Šæ¯èˆ‡åƒæ•¸é¸æ“‡
message = "Hi! This is Cesare!"
binary_message = message_to_binary(message)
print(f"è¨Šæ¯çš„äºŒé€²ä½è¡¨ç¤º: {binary_message}")
l1 = len(binary_message)
print("l1 = ", l1)

w = 256 
logw = 8 # æˆ‘å€‘ä½¿ç”¨å…«å€‹ä½å…ƒç‚ºä¸€å€‹å€æ®µ

# Outputs:
# è¨Šæ¯çš„äºŒé€²ä½è¡¨ç¤º: 01001000011010010010000100100000010101000110100001101001011100110010000001101001011100110010000001000011011001010111001101100001011100100110010100100001
# l1 =  152
```


## é‘°åŒ™ç”Ÿæˆ
```
# é‘°åŒ™ç”Ÿæˆ

# é¦–å…ˆè¨ˆç®—æœ€å¤§å¯èƒ½çš„æ•¸å€¼å’Œæª¢æŸ¥å’Œ

C_max = ((l1//logw)+1)*w

# æœ€é•·å¯èƒ½çš„æ•¸å€¼å’Œæª¢æŸ¥ç¢¼

l2 = len(bin(C_max))-2

print(f"æœ€å¤§å¯èƒ½çš„æ•¸å€¼å’Œæª¢æŸ¥ç¢¼: {C_max} ({l2} bits)")

# Outputs:
# æœ€å¤§å¯èƒ½çš„æ•¸å€¼å’Œæª¢æŸ¥ç¢¼: 5120 (13 bits)
```



```
# é‘°åŒ™ç”Ÿæˆ
# ç”Ÿæˆç§é‘°
l = l1 + l2
print(f"l1 = {l1}, l2 = {l2}, l = {l}")

# è¨ˆç®—æœ€å¤šéœ€è¦å¹¾æŠŠç§é‘°
num_of_sk = (l//logw)+1
print(f"éœ€è¦çš„ç§é‘°æ•¸é‡: {num_of_sk}")

# ç”Ÿæˆç§é‘°
# ç”Ÿæˆ n ä½å…ƒçš„ç§é‘°ï¼ˆ256 ä½å…ƒï¼‰
def generate_n_bits_string(n=256):
    random.seed(42)  # è¨­å®šç¨®å­
    return ''.join([str(random.randint(0, 1)) for i in range(n)])

private_keys = [generate_n_bits_string() for i in range(num_of_sk)]
print(private_keys[0])

# Outputs:
# l1 = 152, l2 = 13, l = 165
# éœ€è¦çš„ç§é‘°æ•¸é‡: 21
# 0010000010000000101100111001001011101010110000100011110110100001110100011100101110100111100100000101111001101101010010010011001100000100010110011111000010000000001001100101100011111000110000101011001000000111010010111111001000100100000001000011101011011100
```


```
# é‘°åŒ™ç”Ÿæˆ
# è¨ˆç®—å…¬é‘°

# XOR å…©å€‹å­—ä¸² 
def xor_bits(a, b):
    result = ""
    for i in range(len(a)):
        result += str(int(a[i]) ^ int(b[i]))
    return result

def c_value_iterate(c_value_prev, r_to_be_xor):
    return hash_func(xor_bits(c_value_prev, r_to_be_xor))  # XOR å’Œå“ˆå¸Œæ“ä½œ
    
def pk_gen(sk, r):
    result = sk
    for i in range(1,w):
        result = c_value_iterate(result, r[i])
    return result

# ç”Ÿæˆå…¬é‘°è£¡é¢çš„ r  
r = [(generate_n_bits_string(n=256)) for _ in range(w)]
# ç‚ºäº†æ–¹ä¾¿ä½¿ç”¨ä¸‹æ¨™ï¼Œæˆ‘å€‘å¤šç”Ÿäº†ä¸€å€‹ r[0] ä½†æˆ‘å€‘ä¸æœƒç”¨å®ƒ
# ç¾åœ¨èµ· r1 = r[1], r2 = r[2], ..., r_{w-1} = r[w-1]




pk = [pk_gen(private_keys[0], r) for _ in range(w)]
print("The first public key is:\n"+str(pk[0]))

# Outputs
# The first public key is:
# 1010101101010110010000010000110101110000001011010101110100111010100010001101101111111011011000010100110101001001101001111101010011100110010110100110101101001010110101010001111001001000011110111010011001001101011110010110100001010110001111001001001010100111
```


## ç°½ç« 

```
# ç°½ç« 
# è¨ˆç®—æ•¸å€¼å’Œæª¢æŸ¥å€¼

print(binary_message)

segment = []
for i in range(0, len(binary_message), logw):
    segment.append(binary_message[i:i+logw])
    if len(segment[-1]) < logw:
        segment[-1] = segment[-1] + "0"*(logw-len(segment[-1]))
print(segment)

# è¨ˆç®—å€å¡Šå€¼
segment_values = [int(s, 2) for s in segment]
print(segment_values)

C = ((l1//logw) + 1) * w - sum(segment_values)
print(f"æ•¸å€¼å’Œæª¢æŸ¥å€¼: {C}")
print(f"æ•¸å€¼å’Œæª¢æŸ¥å€¼çš„äºŒé€²ä½è¡¨ç¤º: {bin(C)[2:]}")


# Outputs: 
# 01001000011010010010000100100000010101000110100001101001011100110010000001101001011100110010000001000011011001010111001101100001011100100110010100100001
# ['01001000', '01101001', '00100001', '00100000', '01010100', '01101000', '01101001', '01110011', '00100000', '01101001', '01110011', '00100000', '01000011', '01100101', '01110011', '01100001', '01110010', '01100101', '00100001']
# [72, 105, 33, 32, 84, 104, 105, 115, 32, 105, 115, 32, 67, 101, 115, 97, 114, 101, 33]
# æ•¸å€¼å’Œæª¢æŸ¥å€¼: 3558
# æ•¸å€¼å’Œæª¢æŸ¥å€¼çš„äºŒé€²ä½è¡¨ç¤º: 110111100110
```


```
# d || C å¤§å­—ä¸²
dC = binary_message + bin(C)[2:]
print(f"d || C å¤§å­—ä¸²: {dC}")

segment = []
for i in range(0, len(dC), logw):
    segment.append(dC[i:i+logw])
    if len(segment[-1]) < logw:
        segment[-1] = segment[-1] + "0"*(logw-len(segment[-1]))
print(segment)
print(len(segment))


# Outputs:
# d || C å¤§å­—ä¸²: 01001000011010010010000100100000010101000110100001101001011100110010000001101001011100110010000001000011011001010111001101100001011100100110010100100001110111100110
#
# ['01001000', '01101001', '00100001', '00100000', '01010100', '01101000', '01101001', '01110011', '00100000', '01101001', '01110011', '00100000', '01000011', '01100101', '01110011', '01100001', '01110010', '01100101', '00100001', '11011110', '01100000']
#
# 21
```




```
# ç°½ç« 
signatures = []
for i in range(len(segment)):
    sg = segment[i]
    signature = private_keys[i]
    sg_value  = int(sg, 2)
    for j in range(1, sg_value+1):
        signature = c_value_iterate(signature, r[j])

    signatures.append(signature)

print(signatures[0])
print(len(signatures))


# Outputs:
# 1000100011111011010000001001111110110011000001001100010010110000100110001010111110001111001100110001110000101110010111011001011000111111101101101100101100001100101000101010110011111001011100110111000110101101101000101100011111100100001011111110111011000011
# 21
```


# é©—ç« 

```
# é©—ç« 
valid = 1
for i in range(len(segment)):
    sg = segment[i]
    signature = signatures[i]
    sg_value  = int(sg, 2)

    for j in range(sg_value+1, w):
        signature = c_value_iterate(signature, r[j])
    
    valid = valid and (signature == pk[i])
print(valid)

# Outputs:
# Ture
```


# Takeaway
- **ç°½ç« å€å¡ŠåŒ–ä»¥æ¸›å°‘å¤§å°**ï¼šé€éå°‡è¨Šæ¯åˆ†ç‚ºå¤šå€‹ä½å…ƒå€å¡Šä¸¦é€å€å¡Šé€²è¡Œç°½ç« ï¼Œå¯ä»¥å¤§å¹…æ¸›å°‘ç°½ç« çš„å¤§å°ï¼Œæå‡æ•´é«”ç³»çµ±çš„æ•ˆç‡ã€‚é€™æ¨£çš„å€å¡ŠåŒ–ç­–ç•¥åœ¨ç¾å¯¦ä¸­å…·å‚™é‡è¦æ„ç¾©ï¼Œç‰¹åˆ¥æ˜¯å°æ–¼é•·åº¦è¼ƒé•·çš„è¨Šæ¯ã€‚
    
- **ä½¿ç”¨æ•¸å€¼å’Œæª¢æŸ¥ç¢¼ä¾†å¢å¼·å®‰å…¨æ€§**ï¼šåŠ å…¥ã€Œæ•¸å€¼å’Œæª¢æŸ¥ç¢¼ã€ï¼ˆchecksumï¼‰ä½œç‚ºå†—é¤˜ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢æ”»æ“Šè€…åœ¨æŸäº›å€å¡Šä¸­ç¯¡æ”¹è¨Šæ¯ã€‚é€™å€‹æ–¹æ³•é€éå»ºç«‹å‰å¾Œå€å¡Šé–“çš„ä¾è³´æ€§ï¼Œä½¿ç¯¡æ”¹å–®ä¸€å€å¡Šè®Šå¾—å›°é›£ã€‚


ref
HÃœLSING, Andreas. W-OTS+â€“shorter signatures for hash-based signature schemes. In:Â _Progress in Cryptologyâ€“AFRICACRYPT 2013: 6th International Conference on Cryptology in Africa, Cairo, Egypt, June 22-24, 2013. Proceedings 6_. Springer Berlin Heidelberg, 2013. p. 173-188.